<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>äº’å‹•æ¶ç­”å¤§è³½ Pro+</title>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

<style>
:root {
    --primary:#6c5ce7;
    --accent:#fdcb6e;
    --danger:#ff7675;
    --success:#55efc4;
}
*{-webkit-tap-highlight-color:transparent}
body{
    margin:0;
    font-family:'PingFang TC','Microsoft JhengHei',sans-serif;
    background:radial-gradient(circle,#6c5ce7,#4834d4);
    color:white;
    display:flex;
    flex-direction:column;
    align-items:center;
}
.header-container{margin:15px 0}
.title-wrap{display:flex;align-items:center;gap:10px}
.event-logo{height:42px}
.event-title{
    font-size:clamp(1.3rem,6vw,2.4rem);
    font-weight:900;
    color:var(--accent);
    text-shadow:2px 2px #d35400;
}
.card{
    background:white;
    color:#2d3436;
    width:90%;
    max-width:460px;
    padding:20px;
    border-radius:25px;
}
.hidden{display:none}
.q-box{
    background:#f1f2f6;
    padding:15px;
    border-radius:15px;
    font-size:1.4rem;
    font-weight:bold;
}
.timer{font-size:2.2rem;color:var(--danger);font-weight:900}
.opt-btn{
    width:100%;
    padding:16px;
    margin:6px 0;
    border:none;
    border-radius:40px;
    font-size:1.1rem;
}
.host-panel{
    position:fixed;
    right:15px;
    bottom:15px;
    background:#000;
    color:white;
    padding:15px;
    border-radius:20px;
    display:flex;
    flex-direction:column;
    gap:8px;
    z-index:999;
}
.host-panel button{
    font-size:.9rem;
    padding:10px;
}
</style>
</head>

<body>

<!-- ===== éŸ³æ•ˆ ===== -->
<audio id="snd-beep" src="beep.mp3"></audio>
<audio id="snd-ok" src="correct.mp3"></audio>
<audio id="snd-ng" src="wrong.mp3"></audio>
<audio id="snd-finish" src="finish.mp3"></audio>

<!-- ===== Header ===== -->
<div class="header-container">
    <div class="title-wrap">
        <img src="logo.png" class="event-logo">
        <div class="event-title">å°å¤ªé™½é ˜è¢–ç‡Ÿ</div>
    </div>
</div>

<!-- ===== Host Panel ===== -->
<div id="host-panel" class="host-panel hidden">
    <div style="font-size:.8rem">ğŸ‘‘ ä¸»æŒäººæ§åˆ¶</div>
    <button onclick="startGame()">ğŸ® é–‹å§‹</button>
    <button onclick="reveal()">ğŸ‘€ æ­æ›‰</button>
    <button onclick="nextQ()">â­ ä¸‹ä¸€é¡Œ</button>
    <button onclick="resetGame()">ğŸ”„ é‡ç½®</button>
</div>

<div class="card">

<div id="view-login">
    <input id="username" placeholder="å§“å / éšŠä¼">
    <button onclick="join()">é€²å…¥</button>
</div>

<div id="view-game" class="hidden">
    <div id="q-header"></div>
    <div id="timer" class="timer"></div>
    <div id="q-content" class="q-box"></div>
    <div id="options"></div>
    <div id="feedback"></div>
</div>

<div id="view-result" class="hidden">
    <h2>ğŸ† æ’è¡Œæ¦œ</h2>
    <div id="result"></div>
</div>

</div>

<script>
/* ===== Firebase ===== */
firebase.initializeApp({
  apiKey:"AIzaSyAMvRegqD33yBy6mcCl3sB9IK8efeECxHk",
  databaseURL:"https://exam-questions-1eb01-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();
const isHost=location.search.includes('host=true');

/* ===== Audio ===== */
const snd={
  beep:document.getElementById('snd-beep'),
  ok:document.getElementById('snd-ok'),
  ng:document.getElementById('snd-ng'),
  fin:document.getElementById('snd-finish')
};

/* ===== State ===== */
let myName="",lastIdx=null,answered=false;

/* ===== View ===== */
const show=v=>{
 document.querySelectorAll('.card>div').forEach(d=>d.classList.add('hidden'));
 document.getElementById(v).classList.remove('hidden');
};

/* ===== Join ===== */
function join(){
 myName=username.value.trim();
 if(!myName)return alert("è«‹è¼¸å…¥åç¨±");
 show('view-game');
 if(isHost) document.getElementById('host-panel').classList.remove('hidden');
}

/* ===== Host Actions ===== */
function startGame(){
 db.ref('game').set({
  status:'playing',
  idx:0,
  timeLeft:15,
  winner:'',
  qs:[
    {question:'ä¸€å¹´å››å­£æ˜¯ï¼Ÿ',options:'A:æ˜¥å¤ç§‹å†¬,B:æ±å—è¥¿åŒ—',answer:'A'},
    {question:'è¥¿ç“œæ˜¯å‹•ç‰©ï¼Ÿ',options:'O,X',answer:'X'}
  ]
 });
}
function reveal(){ db.ref('game/show').set(true); }
function nextQ(){
 db.ref('game').once('value',s=>{
  const g=s.val();
  if(g.idx+1<g.qs.length)
    db.ref('game').update({idx:g.idx+1,timeLeft:15,winner:'',show:false});
  else db.ref('game/status').set('finished');
 });
}
function resetGame(){
 db.ref('game').remove();
 db.ref('players').remove();
 location.reload();
}

/* ===== Game ===== */
db.ref('game').on('value',s=>{
 const g=s.val(); if(!g)return;
 if(g.status==='playing'){
  show('view-game');
  const q=g.qs[g.idx];
  q-header.innerText=`ç¬¬ ${g.idx+1} é¡Œ`;
  q-content.innerText=q.question;
  if(g.idx!==lastIdx){
    lastIdx=g.idx; answered=false;
    options.innerHTML='';
    q.options.split(',').forEach(o=>{
      const b=document.createElement('button');
      b.className='opt-btn';
      b.innerText=o;
      b.onclick=()=>submit(o.includes(':')?o.split(':')[0]:o);
      options.appendChild(b);
    });
  }
  if(g.timeLeft<=3 && g.timeLeft>0) snd.beep.play();
 }
 if(g.status==='finished'){
  show('view-result');
  snd.fin.play();
  db.ref('players').once('value',p=>{
    let html='';
    Object.entries(p.val()||{})
      .sort((a,b)=>b[1]-a[1])
      .forEach(([n,s],i)=>html+=`${i+1}. ${n} ${s}åˆ†<br>`);
    result.innerHTML=html;
  });
 }
});

/* ===== Timer ===== */
if(isHost){
 setInterval(()=>{
  db.ref('game/timeLeft').transaction(t=>t>0?t-1:0);
 },1000);
}

/* ===== Submit ===== */
function submit(ans){
 if(answered)return;
 answered=true;
 db.ref('game').once('value',s=>{
  const g=s.val();
  if(ans===g.qs[g.idx].answer){
    snd.ok.play();
    db.ref('game/winner').transaction(w=>w||myName,(_,ok)=>{
      if(ok) db.ref('players/'+myName).transaction(v=>(v||0)+10);
    });
  }else{
    snd.ng.play();
    feedback.innerText='âŒ éŒ¯èª¤';
  }
 });
}
</script>
</body>
</html>
